<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TMU Dashboard</title>
<style>
  body { 
    font-family: monospace; 
    margin:0; 
    background-color:#0a0a0a; 
    color:#fff; 
    overflow-y:auto; 
  }
  header { display:flex; justify-content:space-between; align-items:center; background-color:#1f1f1f; padding:1rem; border-bottom:2px solid #444; }
  header h1 { font-size:1.8rem; margin:0; }
  #userInfo { font-weight:bold; }
  #logoutBtn { padding:0.4rem 1rem; background-color:#ff0000; color:#fff; border-radius:5px; border:none; cursor:pointer; }
  #logoutBtn:hover { background-color:#cc0000; }

  main {
    display: flex;
    flex-direction: row;
    gap: 1rem;
    padding: 1rem;
  }

  /* Left: Active Split Image */
  #activeSplit { 
    width: 100%; 
    max-width: 600px; 
    display: block; 
    border: 2px solid #4ade80; 
    border-radius: 5px; 
    height: auto; 
  }

  /* Right: Controller list */
  #controllerPane {
    flex: 1;
    padding: 1rem;
    background-color: #111;
    border: 2px solid #333;
    border-radius: 5px;
    max-height: 700px;
    overflow-y: auto;
  }
  #controllerPane h2 {
    margin-top: 0;
    color: #4cafef;
  }
  .controller {
    background: #1a1a1a;
    padding: 0.5rem;
    margin: 0.5rem 0;
    border-radius: 6px;
    border: 1px solid #333;
  }

  /* Footer */
  .footer { position:fixed; bottom:0; left:0; width:100%; background-color:#1f1f1f; border-top:2px solid #444; display:flex; justify-content:center; padding:0.75rem 0; gap:0.5rem; z-index:1000; }
  .footer a { padding:0.5rem 1.5rem; background-color:#18B28E; color:#fff; text-decoration:none; border-radius:5px; font-weight:bold; font-size:1.2rem; transition:background-color 0.2s; }
  .footer a:hover { background-color:#139770; }
</style>
</head>
<body>

<header>
  <h1>TMU Dashboard</h1>
  <div>
    <span id="userInfo"></span>
    <button id="logoutBtn">Logout</button>
  </div>
</header>

<main>
  <!-- Left: Active Split -->
  <div style="flex:1; display:flex; justify-content:center; align-items:flex-start;">
    <img id="activeSplit" src="https://i.ibb.co/x8XKMM8y/image.png" alt="Active Split">
  </div>

  <!-- Right: ZAU Controllers -->
  <div id="controllerPane">
    <h2>ZAU Controllers Online</h2>
    <div id="controllerList"><p>Loading...</p></div>
  </div>
</main>

<!-- Centered Discord widget (full width below panes) -->
<div style="display:flex; justify-content:center; margin:1rem auto;">
  <widgetbot
    server="1411480998771691592"
    channel="1411481254242549943"
    width="70%"
    height="700"
  ></widgetbot>
</div>
<script src="https://cdn.jsdelivr.net/npm/@widgetbot/html-embed"></script>

<div style="height:50px;"></div>

<div class="footer">
  <a href="index.html">SIA</a>
  <a href="wx.html">WX</a>
  <a href="sop.html">SOP</a>
  <a href="pireps.html">PIREPS</a>
  <a href="brief.html">BRIEF</a>
</div>

<script>
  // Session check
  const position = localStorage.getItem("position");
  const initials = localStorage.getItem("initials");
  if(!position || !initials) { 
    alert("Please login first."); 
    window.location.href="index.html"; 
  }
  document.getElementById('userInfo').textContent = `${position} (${initials})`;

  document.getElementById("logoutBtn").addEventListener("click", ()=>{
    localStorage.clear();
    window.location.href="index.html";
  });

  // Fetch ZAU controllers
  async function fetchZAUControllers() {
    try {
      const resp = await fetch('https://data.vatsim.net/v3/vatsim-data.json');
      if (!resp.ok) throw new Error('HTTP status ' + resp.status);
      const data = await resp.json();
      return data.controllers?.filter(c => c.artccId === 'ZAU') || [];
    } catch (err) {
      console.error('Error fetching VATSIM data:', err);
      return [];
    }
  }

  // Display controllers
  function displayControllers(ctrls) {
    const list = document.getElementById('controllerList');
    list.innerHTML = '';
    if (ctrls.length === 0) {
      list.innerHTML = '<p>No ZAU controllers online currently.</p>';
      return;
    }
    ctrls.forEach(c => {
      const d = document.createElement('div');
      d.className = 'controller';
      d.textContent = `${c.callsign} â€” ${c.name}${c.frequency ? ' (' + c.frequency + ')' : ''}`;
      list.appendChild(d);
    });
  }

  async function init() {
    const ctrls = await fetchZAUControllers();
    displayControllers(ctrls);
  }

  init();
  setInterval(init, 15000); // refresh every 15s
</script>

</body>
</html>
