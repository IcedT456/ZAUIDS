<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PIREPS</title>
<style>
body {
  font-family: monospace;
  margin: 0;
  background-color: #0a0a0a;
  color: #fff;
  display: flex;
  flex-direction: column;
  height: 100vh;
}
header {
  background-color: #1f1f1f;
  padding: 1rem;
  border-bottom: 2px solid #444;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
header h1 { font-size: 1.8rem; margin:0; }
#userInfo { font-size:1.2rem; }
#logoutBtn {
  padding: 0.4rem 1rem;
  background-color: #ff0000;
  color: #fff;
  border-radius: 5px;
  border:none;
  cursor:pointer;
}
#logoutBtn:hover { background-color:#cc0000; }

.main-content {
  flex: 1;
  display: flex;
  overflow: hidden;
}

/* Form section */
#pirepForm {
  width: 280px;
  padding: 1rem;
  border-right: 2px solid #444;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  overflow-y: auto;
}
#pirepForm label { font-weight: bold; }
#pirepForm input, #pirepForm textarea, #pirepForm select {
  padding:0.3rem;
  font-size:1rem;
  background-color:#1f1f1f;
  border:1px solid #444;
  border-radius:5px;
  color:#fff;
}
#pirepForm textarea { resize: vertical; min-height:60px; }
#submitPirep {
  padding:0.5rem 1rem;
  font-weight:bold;
  background-color:#00ff00;
  border:none;
  border-radius:5px;
  cursor:pointer;
}
#submitPirep:hover { background-color:#00cc00; }

/* PIREP list */
#pirepList {
  flex: 1;
  padding: 1rem;
  display:flex;
  flex-direction: column;
  gap:0.5rem;
  overflow-y: auto;
}
.pirep-item {
  border:1px solid #444;
  padding:0.5rem;
  border-radius:5px;
  background-color:#1f1f1f;
  word-wrap: break-word;
}
.pirep-item span { display:block; }

/* Footer */
.footer {
  flex-shrink: 0;
  background-color:#1f1f1f;
  border-top:2px solid #444;
  display:flex;
  justify-content:center;
  padding:0.75rem 0;
  gap:0.5rem;
  z-index:1000;
}
.footer a{
  padding:0.5rem 1.5rem;
  background-color: #18B28E;
  color: #fff;
  text-decoration: none;
  border-radius:5px;
  font-weight:bold;
  font-size:1.2rem;
  transition: background-color 0.2s;
}
.footer a:hover { background-color:#139770; }
</style>
</head>
<body>

<header>
  <h1>PIREPS</h1>
  <div style="display:flex; align-items:center; gap:1rem;">
    <span id="userInfo"></span>
    <button id="logoutBtn" style="display:none;">Logout</button>
  </div>
</header>

<div class="main-content">
  <form id="pirepForm">
    <label>1. UA/UUA</label>
    <select id="uauua" required>
      <option value="">Select</option>
      <option value="UA">UA</option>
      <option value="UUA">UUA</option>
    </select>

    <label>2. /OV</label><input type="text" id="ov" required>
    <label>3. /TM</label><input type="text" id="tm" required>
    <label>4. /FL</label><input type="text" id="fl" required>
    <label>5. /TP</label><input type="text" id="tp" required>
    <label>6. /SK</label><input type="text" id="sk">
    <label>7. /WX</label><input type="text" id="wx">
    <label>8. /TA</label><input type="text" id="ta">
    <label>9. /WV</label><input type="text" id="wv">
    <label>10. /TB</label><input type="text" id="tb">
    <label>11. /IC</label><input type="text" id="ic">
    <label>12. /RM</label><textarea id="rm"></textarea>

    <button type="submit" id="submitPirep">Submit PIREP</button>
  </form>

  <div id="pirepList"></div>
</div>

<div class="footer">
  <a href="index.html">SIA</a>
  <a href="wx.html">WX</a>
  <a href="sop.html">SOP</a>
  <a href="pireps.html">PIREPS</a>
  <a href="brief.html">BRIEF</a>
</div>

<script>
// USER INFO
const userInfo = document.getElementById("userInfo");
const logoutBtn = document.getElementById("logoutBtn");
function updateUser(){
  const pos = localStorage.getItem("position");
  const init = localStorage.getItem("initials");
  if(pos && init){
    userInfo.textContent = `${pos} (${init})`;
    logoutBtn.style.display="inline-block";
  } else {
    alert("You must log in to submit PIREPs!");
    window.location.href="index.html";
  }
}
logoutBtn.addEventListener("click", ()=>{
  localStorage.clear();
  window.location.href="index.html";
});
updateUser();

// PERSISTENCE
let pireps = JSON.parse(localStorage.getItem("pireps")||"[]");

// Remove old (>3h) PIREPs
function removeOldPireps(){
  const now = Date.now();
  pireps = pireps.filter(p => now - p.timestamp < 3*60*60*1000);
  localStorage.setItem("pireps", JSON.stringify(pireps));
}

// DISPLAY
function displayPireps(){
  removeOldPireps();
  const list = document.getElementById("pirepList");
  list.innerHTML = "";
  const sorted = pireps.sort((a,b)=>{
    if(a.uauua===b.uauua) return b.timestamp - a.timestamp;
    return a.uauua === "UA" ? -1 : 1;
  });
  sorted.forEach(p=>{
    const div = document.createElement("div");
    div.className="pirep-item";
    const zuluTime = new Date(p.timestamp).toISOString().slice(11,19)+"Z";
    div.innerHTML = `
      <span><strong>${p.uauua}</strong> <em>${zuluTime}</em></span>
      <span><strong>/OV:</strong> ${p.ov}</span>
      <span><strong>/TM:</strong> ${p.tm}</span>
      <span><strong>/FL:</strong> ${p.fl}</span>
      <span><strong>/TP:</strong> ${p.tp}</span>
      ${p.sk?`<span><strong>/SK:</strong> ${p.sk}</span>`:""}
      ${p.wx?`<span><strong>/WX:</strong> ${p.wx}</span>`:""}
      ${p.ta?`<span><strong>/TA:</strong> ${p.ta}</span>`:""}
      ${p.wv?`<span><strong>/WV:</strong> ${p.wv}</span>`:""}
      ${p.tb?`<span><strong>/TB:</strong> ${p.tb}</span>`:""}
      ${p.ic?`<span><strong>/IC:</strong> ${p.ic}</span>`:""}
      ${p.rm?`<span><strong>/RM:</strong> ${p.rm}</span>`:""}
    `;
    list.appendChild(div);
  });
  localStorage.setItem("pireps", JSON.stringify(pireps));
}
displayPireps();

// FORM SUBMISSION
document.getElementById("pirepForm").addEventListener("submit", e=>{
  e.preventDefault();
  const p = {
    uauua: document.getElementById("uauua").value,
    ov: document.getElementById("ov").value.trim(),
    tm: document.getElementById("tm").value.trim(),
    fl: document.getElementById("fl").value.trim(),
    tp: document.getElementById("tp").value.trim(),
    sk: document.getElementById("sk").value.trim(),
    wx: document.getElementById("wx").value.trim(),
    ta: document.getElementById("ta").value.trim(),
    wv: document.getElementById("wv").value.trim(),
    tb: document.getElementById("tb").value.trim(),
    ic: document.getElementById("ic").value.trim(),
    rm: document.getElementById("rm").value.trim(),
    timestamp: Date.now()
  };
  if(!p.uauua||!p.ov||!p.tm||!p.fl||!p.tp){ alert("Fields 1-5 are mandatory."); return; }
  pireps.push(p);
  localStorage.setItem("pireps", JSON.stringify(pireps));
  displayPireps();
  document.getElementById("pirepForm").reset();
});

// Auto-refresh
setInterval(displayPireps, 60*1000);
</script>

</body>
</html>
